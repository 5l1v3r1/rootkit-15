%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% University/School Laboratory Report
% LaTeX Template
% Version 3.1 (25/3/14)
%
% This template has been downloaded from:
% http://www.LaTeXTemplates.com
%
% Original author:
% Linux and Unix Users Group at Virginia Tech Wiki
% (https://vtluug.org/wiki/Example_LaTeX_chem_lab_report)
%
% License:
% CC BY-NC-SA 3.0 (http://creativecommons.org/licenses/by-nc-sa/3.0/)
%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

%----------------------------------------------------------------------------------------
%   PACKAGES AND DOCUMENT CONFIGURATIONS
%----------------------------------------------------------------------------------------

\documentclass[12pt]{article}
\usepackage[utf8]{inputenc}
\usepackage[english]{babel}
\usepackage[babel]{csquotes}
\usepackage[T1]{fontenc}
\usepackage{hyperref}
\usepackage{amsmath}
\usepackage{enumitem}
\usepackage{lmodern}
\usepackage{selinput}
\usepackage{listings}
\usepackage{amssymb}% http://ctan.org/pkg/amssymb
\usepackage{pifont}% http://ctan.org/pkg/pifont
\usepackage{ulem}
\usepackage[usenames,dvipsnames]{xcolor}
\usepackage[breakable, theorems, skins]{tcolorbox}
\usepackage{soul}
\tcbset{enhanced}
\newcommand*\xor{\mathbin{\oplus}}
\definecolor{mygreen}{rgb}{0,0.6,0}
\definecolor{mygray}{rgb}{0.5,0.5,0.5}
\definecolor{mymauve}{rgb}{0.58,0,0.82}

\lstset{ %
  backgroundcolor=\color{white},   % choose the background color
  basicstyle=\footnotesize,        % size of fonts used for the code
  breaklines=true,                 % automatic line breaking only at whitespace
  captionpos=b,                    % sets the caption-position to bottom
  commentstyle=\color{mygreen},    % comment style
  escapeinside={\%*}{*)},          % if you want to add LaTeX within your code
  keywordstyle=\color{blue},       % keyword style
  stringstyle=\color{mymauve},     % string literal style
}
%\usepackage{times} % Uncomment to use the Times New Roman font

%----------------------------------------------------------------------------------------
%   DOCUMENT INFORMATION
%----------------------------------------------------------------------------------------

\title{\huge{Keylogger/Backdoor Rootkit} \\\large{Winter term 2015/16} \\\quad \\\huge{Applied Information Security}}


\author{Clemens \textsc{Brunner}\\
        Michael \textsc{Fr√∂wis}} % Author name


\date{\today} % Date for the report

\begin{document}

\maketitle % Insert the title, author and date
\thispagestyle{empty}
\newpage
\tableofcontents
\thispagestyle{empty}

\newpage

\section{Introduction}

In the following we want to explore how to make a linux kernel rootkit. As the definition of a rootkit stats it should run as root and should be hard to detect for users. To give the rootkit real value it has to do something. We decided to go with two very common usecases when it comes to 


\subsection{Kernel Modules}

\subsection{Kernel Rootkits}

\section{Implementation}

\subsection{Keylogging}
This section deals about keylogging in linux kernel. Keylogging describes the process of intercepting all inputkeys from a keyboard. Our rootkit intercepts all keys and sends them to a server. It is possible to activate and deactivate the keylogging function with a magic package, see \ref{sec:magicpackage}. 
To implement a keylogger in the linux kernel you must register a keyboard notifier.

\begin{lstlisting}
	register_keyboard_notifier(&keyboard_notifier);
\end{lstlisting}

The keyboard notifier stores the \lstinline{keyboard_hook} method which will be called on each key press. This function gets a keyboard keycode as input, to filter out the associated character we use two arrays with the mapping for the american keyboard layout. The first one is the mapping without \lstinline{SHIFT} and the secound is with \lstinline{SHIFT} pressed.


\subsection{Backdoor}
\subsection{Hiding}

\subsection{Networking and Activation}
\label{sec:magicpackage}
To communicate with the rootkit two methods are used.
\begin{itemize}
	\item ICMP Packages
	\item UDP Sockets
\end{itemize}
\subsubsection{ICMP Packages}
To activate the keylogger, hide the rootkit modul or open a backdoor shell with root access magic packages are used. We used a normal ping package where the \lstinline{code} is the same as the \lstinline{id}. The following values are used for code and id to assign the descriped functionality.
\begin{itemize}
	\item[122:] \lstinline{KEYLOGGER_ACTIVATION_CODE}
	\item[123:] \lstinline{KEYLOGGER_DEACTIVATION_CODE}
	\item[124:] \lstinline{HIDEMODULE_ACTIVATION_CODE}
	\item[125:] \lstinline{HIDEMODULE_DEACTIVATION_CODE}
	\item[126:] \lstinline{BACKDOOR_ACTIVATION_CODE}
\end{itemize}

To catch the packages a new \lstinline{netfilter_hook} is added with the netfilter libary. 
\begin{lstlisting}
	nf_register_hook(&netfilter_hook);
\end{lstlisting}

The netfilter hook catches all icmp packages for the evaluation only packages the already defined properties are used. 

\subsubsection{UPD Sockets}
For sending the keys to the client and for controlling the server with the backdoor shell, UPD datagram packages are used.

\section{Conclusion}

\end{document}

